name: Issue Management

on:
  issues:
    types: [opened, edited, labeled]
  issue_comment:
    types: [created]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Auto-label new issues
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = issue.body.toLowerCase();
            
            // Auto-label based on title and content
            const labels = [];
            
            if (title.includes('[bug]') || body.includes('bug') || body.includes('é”™è¯¯')) {
              labels.push('bug');
            }
            
            if (title.includes('[performance]') || body.includes('performance') || body.includes('å¡é¡¿') || body.includes('å´©æºƒ')) {
              labels.push('performance');
            }
            
            if (title.includes('[support]') || body.includes('support') || body.includes('å¸®åŠ©')) {
              labels.push('support');
            }
            
            if (title.includes('[feature]') || body.includes('feature') || body.includes('åŠŸèƒ½')) {
              labels.push('enhancement');
            }
            
            // Priority labels
            if (body.includes('é«˜ä¼˜å…ˆçº§') || body.includes('ç´§æ€¥') || body.includes('å´©æºƒ')) {
              labels.push('priority-high');
            } else if (body.includes('ä¸­ä¼˜å…ˆçº§') || body.includes('ä¸€èˆ¬')) {
              labels.push('priority-medium');
            } else if (body.includes('ä½ä¼˜å…ˆçº§') || body.includes('ä¸æ€¥')) {
              labels.push('priority-low');
            }
            
            // Component labels
            if (body.includes('å¤´åƒç”Ÿæˆ') || body.includes('avatar generation')) {
              labels.push('component-generation');
            }
            
            if (body.includes('å›¾ç‰‡é¢„è§ˆ') || body.includes('image preview')) {
              labels.push('component-preview');
            }
            
            if (body.includes('å†å²è®°å½•') || body.includes('history')) {
              labels.push('component-history');
            }
            
            if (body.includes('è®¢é˜…') || body.includes('ä»˜è´¹') || body.includes('subscription')) {
              labels.push('component-subscription');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labels
              });
            }

  welcome-comment:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Welcome new contributors
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            
            const welcomeMessage = `ğŸ‘‹ æ„Ÿè°¢æ‚¨æäº¤ Issueï¼
            
æˆ‘ä»¬å·²ç»æ”¶åˆ°æ‚¨çš„åé¦ˆï¼Œå›¢é˜Ÿä¼šå°½å¿«å¤„ç†ã€‚åœ¨æ­¤æœŸé—´ï¼š

ğŸ“‹ **è¯·ç¡®ä¿æ‚¨å·²æä¾›**ï¼š
- è¯¦ç»†çš„è®¾å¤‡ä¿¡æ¯ï¼ˆè®¾å¤‡å‹å·ã€iOSç‰ˆæœ¬ã€åº”ç”¨ç‰ˆæœ¬ï¼‰
- æ¸…æ™°çš„é—®é¢˜æè¿°å’Œå¤ç°æ­¥éª¤
- ç›¸å…³çš„æˆªå›¾æˆ–è§†é¢‘ï¼ˆå¦‚æœé€‚ç”¨ï¼‰

â° **é¢„æœŸå“åº”æ—¶é—´**ï¼š
- ğŸ”´ ç´§æ€¥é—®é¢˜ï¼š24å°æ—¶å†…å“åº”
- ğŸŸ¡ ä¸€èˆ¬é—®é¢˜ï¼š2-3ä¸ªå·¥ä½œæ—¥å“åº”
- ğŸŸ¢ åŠŸèƒ½å»ºè®®ï¼š1å‘¨å†…å“åº”

ğŸ“ **å…¶ä»–è”ç³»æ–¹å¼**ï¼š
- é‚®ä»¶æ”¯æŒï¼šsupport@emojiavatar.com
- ç¤¾åŒºè®¨è®ºï¼š[GitHub Discussions](https://github.com/${context.repo.owner}/${context.repo.repo}/discussions)

æ„Ÿè°¢æ‚¨å¸®åŠ©æˆ‘ä»¬æ”¹è¿› EmojiAvatarï¼ğŸ¨`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: welcomeMessage
            });

  stale-issues:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          stale-issue-message: |
            ğŸ‘‹ è¿™ä¸ª Issue å·²ç» 30 å¤©æ²¡æœ‰æ´»åŠ¨äº†ã€‚
            
            å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·å›å¤æ­¤æ¶ˆæ¯è®©æˆ‘ä»¬çŸ¥é“ã€‚
            å¦‚æœé—®é¢˜å·²è§£å†³ï¼Œæˆ‘ä»¬å°†åœ¨ 7 å¤©åè‡ªåŠ¨å…³é—­æ­¤ Issueã€‚
            
            æ„Ÿè°¢æ‚¨çš„ç†è§£ï¼
          close-issue-message: |
            ğŸ”’ ç”±äºé•¿æ—¶é—´æ²¡æœ‰æ´»åŠ¨ï¼Œæ­¤ Issue å·²è¢«è‡ªåŠ¨å…³é—­ã€‚
            
            å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·åˆ›å»ºæ–°çš„ Issueã€‚
            æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼
          stale-issue-label: 'stale'
          days-before-stale: 30
          days-before-close: 7
          exempt-issue-labels: 'pinned,security,enhancement'
